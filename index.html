<!DOCTYPE html>

<html>
<head>
<link rel="stylesheet" type="text/css" href="graph.css">
<link href='https://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Coming+Soon' rel='stylesheet' type='text/css'>
<style>
	#welcome {
		font-family: 'Lobster', cursive;
		position:absolute;
		top:40px;
		left:110px;
		text-align:center;
		font-size:40px;
		color:#FF5254;
		/* Rotate div */
		-ms-transform: rotate(-3deg); /* IE 9 */
		-webkit-transform: rotate(-3deg); /* Chrome, Safari, Opera */
		transform: rotate(-3deg);
	}
	#description {
		font-family: 'Coming Soon', cursive;
		position:absolute;
		top:130px;
		left:100px;
		text-align:center;
		font-size:16px;
		color:#013;
		/* Rotate div */
		-ms-transform: rotate(-3deg); /* IE 9 */
		-webkit-transform: rotate(-3deg); /* Chrome, Safari, Opera */
		transform: rotate(-3deg);
	}
	#infobar {
		font-family: 'Coming Soon', cursive;
		position:absolute;
		top:50px;
		right:10px;
		text-align:center;
		font-size:16px;
		color:#013;
		/* Rotate div */
		-ms-transform: rotate(6deg); /* IE 9 */
		-webkit-transform: rotate(6deg); /* Chrome, Safari, Opera */
		transform: rotate(6deg);
	}
	#contents{
		position: absolute;
		top:180px;
		left:120px;
	}
	li{
		font-style:normal;
		font-weight:normal;
		color:#78a;
		font-family: 'Coming Soon', cursive;
		/* Rotate div */
		-ms-transform: rotate(-3deg); /* IE 9 */
		-webkit-transform: rotate(-3deg); /* Chrome, Safari, Opera */
		transform: rotate(-3deg);
	}
</style>
</head>

<body>

<div id = "canvasbox">
	<canvas id = "graph">Your browser does not support the HTML5 canvas tag.</canvas>
</div>

<div>
	<p id = "welcome">Graph Paper</p>
	<p id = "description">Programs that take place on grids</p>
	<div id = "contents">
		<ul>
		<li>Draw something on this page</li>
		<ul>
			<li><a href="graph-paper.html">Plain Paper</a></li>
			<li><a href="graph-colours.html">Pixel Paper</a></li>
		</ul>
		<li><a href="graph-dragon.html">Dragon Curve</a></li>
		<ul>
			<li><a href="graph-L-system.html">L-Systems</a></li>
			<li><a href="graph-tree.html">L-System Trees</a></li>
		</ul>
		<li><a href="graph-fluid.html">Fluid Simulation</a></li>
		<ul>
			<li><a href="graph-SPH.html">SPH</a></li>
		</ul>
		<li><a href="graph-gol.html">Game of Life</a></li>
		<ul>
			<li><a href="graph-CA.html">Stochastic Cellular Automata</a></li>
		</ul>
		<li><a href="graph-maze.html">Maze</a></li>
		<li><a href="graph-background.html">Game</a></li>
		</ul>
	</div>
	<p id = "infobar">The info bar contains options </br>and controls for each page</p>
</div>

<div id = "menu">
	<p style = "text-align: center;">info</p>
	<p id = "fps">fps: 0</p>
	<h1>Draw Something</h1>
	<p class = "hoverbutton" id = "reset" >reset</p>
	<p class = "hoverbutton" id = "bluepen" style="background-color:#89a;">blue</p>
	<p class = "hoverbutton" id = "redpen" style="background-color:#FF8587;">red</p>
	<p class = "hoverbutton" id = "greenpen" style="background-color:#55A88F;margin-bottom:20px;">green</p>
	
	<p>
		This page is <a href="graph-paper.html">just plain paper</a> to draw on. 
	</p>
	<p>
		This page is <a href="graph-colours.html">pixelated paper</a> to draw on. 
	</p>
</div>

<div id = "footer">
	<p style = "text-align:center;">previous | <a href="index.html">menu</a> | <a href="graph-dragon.html">next</a> </p>
</div>

<script>

	// Initialise canvas
	var c = document.getElementById("graph");
	var paper = c.getContext("2d");
	W=window.innerWidth;
	H=window.innerHeight;
	c.width = W;
	c.height = H;
	paper.fillStyle = '#fff';
	paper.fillRect(0,0,W,H);
	var pencolour = '#349';
	drawpage();

	// Initialise mouse functions
	var xold = -1;
	var yold = -1;
	var xpos = -1;
	var ypos = -1;
	var clicked = 0;
	document.onmousemove = coords;
	document.onmousedown = click;
	document.onmouseup = unclick;

	function drawpage(){
		// Draw lines with spacing dx, horizontally and vertically		
		dx = 20;
		paper.beginPath();
		paper.strokeStyle="#bce";
		paper.lineCap = 'square';
		paper.lineWidth=1;
		for (var i = dx/2+.5; i < W; i+=dx){
			paper.moveTo(i,0);
			paper.lineTo(i,H);
			paper.stroke();
		}
		for (var i = dx/2+.5; i < H; i+=dx){
			paper.moveTo(0,i);
			paper.lineTo(W,i);
			paper.stroke();
		}
		
		// Red line down left side
		paper.beginPath()
		paper.strokeStyle="#FF5254";
		paper.lineWidth=3;
		paper.moveTo(0,0);
		paper.lineTo(0,H);
		paper.stroke();
		
		// Hole punches
		addhole(40,H/5);
		addhole(40,H/5+50);

		addhole(40,4*H/5);
		addhole(40,4*H/5-50);
	}

	function addhole(x,y){
		// Draw shadow circle
		paper.strokeStyle="#bce";
		paper.lineWidth=1;
		paper.fillStyle="#679";
		paper.beginPath();
		paper.arc(x, y, dx/1.5, 0, 2 * Math.PI);
		paper.stroke();
		paper.fill();
		
		// Draw white circle
		paper.beginPath();
		paper.arc(x+1, y+1, dx/1.5, 0, 2 * Math.PI);
		paper.stroke();
		paper.fillStyle="white";
		paper.fill();
	}
	
	// Animate function modified from https://hacks.mozilla.org/2011/08/animating-with-javascript-from-setinterval-to-requestanimationframe/
	// calculate the difference in time and pass to the given render function, render function returns false to stop, will not render if deltaT is too high
	function animate( render ) {
		var running, lastFrame = +new Date;
		function loop( now ) {
			// stop the loop if render returned false
			if ( running !== false ) {
				requestAnimationFrame( loop );
				var deltaT = now - lastFrame;
				document.getElementById("fps").innerHTML = "fps: " + 1000/deltaT;
				// do not render frame when deltaT is too high
				if ( deltaT < 160 ) {
					running = render( deltaT );
				}
				lastFrame = now;
			} else {
				document.getElementById("fps").innerHTML = "fps: 0";
			}
		}
		loop( lastFrame );
	}

	function draw(dt){
		// Draw if clicked and there is a previous mouse location. else return false
		if(clicked){
			if (xold != -1 && yold != -1){
				paper.strokeStyle=pencolour;
				paper.beginPath();
				paper.moveTo(xold,yold);
				paper.lineTo(xpos, ypos);
				paper.stroke();
			}
		} else {
			return false;
		}
		// update old mouse position
		xold = xpos
		yold = ypos
	}

	// Mouse and keyboard functions
	function coords(e){
		xpos = e.clientX;
		ypos = e.clientY;
	}
	function click (){
		clicked = 1;
		animate(draw);
	}
	function unclick (){
		clicked = 0;
		xold = -1;
		yold = -1;
	}
	
	// Button functions
	window.onload = function() {
		reset.onmousedown = function() {
			paper.fillStyle = 'rgba(255,255,255,1)';
			paper.fillRect(0,0,W,H);
			drawpage();
			return false;
		}
		bluepen.onmousedown = function() {
			pencolour = '#349';
			return false;
		}
		redpen.onmousedown = function() {
			pencolour = '#FF5254';
			return false;
		}
		greenpen.onmousedown = function() {
			pencolour = '#33b66F';
			return false;
		}
	}

</script>

</body>
</html>
